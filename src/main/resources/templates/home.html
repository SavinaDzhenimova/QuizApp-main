<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec='http://www.thymeleaf.org/extras/spring-security'>

<head>
    <th:block th:replace="~{fragments/commons::head}"></th:block>
    <link rel="stylesheet" href="/css/home-styles.css">
    <title>Профил</title>
</head>

<body>

    <header th:replace="~{fragments/commons::header}"></header>

    <main>
        <div class="profile-container">
            <section class="profile-info">
                <h2 th:text="${user.username}">Username</h2>

                <div class="user-info">
                    <p>Email: <span th:text="${user.email}">user@example.com</span></p>
                    <p><a th:href="@{/users/update-password}">Промяна на парола</a></p>
                </div>
            </section>

            <section th:unless="userStats == null" class="profile-stats" sec:authorize="hasRole('USER')">
                <h3>Статистика</h3>
                <ul>
                    <li>Общо решени куизове: <span th:text="${userStats.totalQuizzes}">0</span></li>
                    <li>Среден резултат: <span th:text="${#numbers.formatDecimal(userStats.averageScore, 0, 0)} + '%'">0%</span></li>
                    <li>Общо верни отговори: <span th:text="${userStats.score}">0</span></li>
                    <li>Общо решени въпроси: <span th:text="${userStats.maxScore}">0</span></li>
                    <li>Последно решавал на:
                        <span th:if="${userStats.lastSolvedAt != null}"
                              th:text="${#temporals.format(userStats.lastSolvedAt, 'dd.MM.yyyy г. HH:mm')}"></span>
                        <span th:if="${userStats.lastSolvedAt == null}">Все още не сте решавали куизове</span>
                    </li>
                </ul>
            </section>

            <section class="solved-quizzes" sec:authorize="hasRole('USER')">
                <h3>История на куизовете</h3>
                <p th:if="${warning}" th:text="${warning}"></p>
                <table th:unless="${user.solvedQuizzes.isEmpty()}">
                    <thead>
                    <tr>
                        <th>Дата</th>
                        <th>Категория</th>
                        <th>Резултат</th>
                        <th>Макс. резултат</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="sq : ${user.solvedQuizzes}">
                        <td th:text="${#temporals.format(sq.solvedAt, 'dd.MM.yyyy г. HH:mm')}">01.01.2025</td>
                        <td th:text="${sq.categoryName}">Наука</td>
                        <td th:text="${sq.correctAnswers}">4</td>
                        <td th:text="${sq.totalQuestions}">5</td>
                    </tr>
                    </tbody>
                </table>

                <a th:href="@{/users/quizzes}" class="btn-start">Виж всички</a>
            </section>

            <div class="admin-section" sec:authorize="hasRole('ADMIN')">
                <h3>Админ панел</h3>

                <div class="admin-authorities">
                    <section class="authority">
                        <a th:href="@{/admin}" class="btn-start">Администратори</a>
                    </section>

                    <section class="authority">
                        <a th:href="@{/admin/add-admin}" class="btn-start">Добави админ</a>
                    </section>

                    <section class="authority">
                        <a th:href="@{/categories/add-category}" class="btn-start">Добави категория</a>
                    </section>

                    <section class="authority">
                        <a th:href="@{/categories}" class="btn-start">Всички категории</a>
                    </section>

                    <section class="authority">
                        <a th:href="@{/questions/add-question}" class="btn-start">Добави въпрос</a>
                    </section>

                    <section class="authority">
                        <a th:href="@{/questions}" class="btn-start">Всички въпроси</a>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <footer th:replace="~{fragments/commons::footer}"></footer>

</body>
</html>